<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/main/index.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/CodingBobby/traktify/issues" target="_blank" class="menu-item" id="issues_link" >Bugs & Issues</a></h2><h2><a href="https://circleci.com/gh/CodingBobby/traktify" target="_blank" class="menu-item" id="build_link" >Build Log</a></h2><h2><a href="https://discord.gg/BJNAMcj" target="_blank" class="menu-item" id="discord_link" >Discord Server</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-api_.html">Internal API</a></li><li><a href="tutorial-contributing.html">Contributing</a></li><li><a href="tutorial-ipc.html">Internal Communication</a></li></ul><h3>Classes</h3><ul><li><a href="Modules.API.CachedTraktor.html">CachedTraktor</a><ul class='methods'><li data-type='method'><a href="Modules.API.CachedTraktor.html#cacheware">cacheware</a></li></ul></li><li><a href="Modules.API.Traktor.html">Traktor</a><ul class='methods'><li data-type='method'><a href="Modules.API.Traktor.html#availableMethods">availableMethods</a></li><li data-type='method'><a href="Modules.API.Traktor.html#extractSearchResultDetails">extractSearchResultDetails</a></li><li data-type='method'><a href="Modules.API.Traktor.html#hiddenShows">hiddenShows</a></li><li data-type='method'><a href="Modules.API.Traktor.html#itemSummary">itemSummary</a></li><li data-type='method'><a href="Modules.API.Traktor.html#latestActivities">latestActivities</a></li><li data-type='method'><a href="Modules.API.Traktor.html#traktSearch">traktSearch</a></li><li data-type='method'><a href="Modules.API.Traktor.html#watchedMovies">watchedMovies</a></li><li data-type='method'><a href="Modules.API.Traktor.html#watchedShows">watchedShows</a></li></ul></li><li><a href="Modules.Manager.Cache.html">Cache</a><ul class='methods'><li data-type='method'><a href="Modules.Manager.Cache.html#getKey">getKey</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#keyStatus">keyStatus</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#remove">remove</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#removeKey">removeKey</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#retrieve">retrieve</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#save">save</a></li><li data-type='method'><a href="Modules.Manager.Cache.html#setKey">setKey</a></li></ul></li><li><a href="Modules.Manager.Queue.html">Queue</a><ul class='methods'><li data-type='method'><a href="Modules.Manager.Queue.html#_doTick">_doTick</a></li><li data-type='method'><a href="Modules.Manager.Queue.html#_duplicates">_duplicates</a></li><li data-type='method'><a href="Modules.Manager.Queue.html#add">add</a></li></ul></li><li><a href="Modules.Manager.SwitchBoard.html">SwitchBoard</a><ul class='methods'><li data-type='method'><a href="Modules.Manager.SwitchBoard.html#on">on</a></li><li data-type='method'><a href="Modules.Manager.SwitchBoard.html#send">send</a></li></ul></li><li><a href="Modules.Manager.Task.html">Task</a><ul class='methods'><li data-type='method'><a href="Modules.Manager.Task.html#run">run</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Modules.html">Modules</a></li><li><a href="Modules.API.html">API</a><ul class='methods'><li data-type='method'><a href="Modules.API.html#.authenticateUser">authenticateUser</a></li><li data-type='method'><a href="Modules.API.html#.connectUser">connectUser</a></li><li data-type='method'><a href="Modules.API.html#.formatSearch">formatSearch</a></li><li data-type='method'><a href="Modules.API.html#.getAPIKeys">getAPIKeys</a></li><li data-type='method'><a href="Modules.API.html#.runWithTimer">runWithTimer</a></li><li data-type='method'><a href="Modules.API.html#.startsWithFilter">startsWithFilter</a></li></ul></li><li><a href="Modules.App.html">App</a><ul class='methods'><li data-type='method'><a href="Modules.App.html#.buildAppWindow">buildAppWindow</a></li><li data-type='method'><a href="Modules.App.html#.initFileStructure">initFileStructure</a></li><li data-type='method'><a href="Modules.App.html#.initGetListener">initGetListener</a></li><li data-type='method'><a href="Modules.App.html#.initLogListener">initLogListener</a></li><li data-type='method'><a href="Modules.App.html#.initSystemListener">initSystemListener</a></li><li data-type='method'><a href="Modules.App.html#.loadPage">loadPage</a></li><li data-type='method'><a href="Modules.App.html#.readConfig">readConfig</a></li><li data-type='method'><a href="Modules.App.html#.saveConfig">saveConfig</a></li><li data-type='method'><a href="Modules.App.html#.startApp">startApp</a></li></ul></li><li><a href="Modules.Manager.html">Manager</a></li><li><a href="Modules.Renderer.html">Renderer</a><ul class='methods'><li data-type='method'><a href="Modules.Renderer.html#.auth">auth</a></li><li data-type='method'><a href="Modules.Renderer.html#.browse">browse</a></li><li data-type='method'><a href="Modules.Renderer.html#.listen">listen</a></li><li data-type='method'><a href="Modules.Renderer.html#.tracer">tracer</a></li></ul></li><li><a href="Modules.Renderer.Get.html">Get</a><ul class='methods'><li data-type='method'><a href="Modules.Renderer.Get.html#.available">available</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.details">details</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.hidden">hidden</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.latest">latest</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.movies">movies</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.search">search</a></li><li data-type='method'><a href="Modules.Renderer.Get.html#.shows">shows</a></li></ul></li><li><a href="Traktify.html">Traktify</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createSlide">createSlide</a></li><li><a href="global.html#createTile">createTile</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#getProgressRatio">getProgressRatio</a></li><li><a href="global.html#parseEpisodeImage">parseEpisodeImage</a></li><li><a href="global.html#parseEpisodeTitle">parseEpisodeTitle</a></li><li><a href="global.html#playSlides">playSlides</a></li><li><a href="global.html#requestUpdateDetails">requestUpdateDetails</a></li><li><a href="global.html#setAlertbox">setAlertbox</a></li><li><a href="global.html#setTextUNTW">setTextUNTW</a></li><li><a href="global.html#setTileActionButton">setTileActionButton</a></li><li><a href="global.html#shuffleArray">shuffleArray</a></li><li><a href="global.html#toggleAlert">toggleAlert</a></li><li><a href="global.html#updateNextTile">updateNextTile</a></li><li><a href="global.html#userLoading">userLoading</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">pages/main/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const dummyData = [
  {
    id: 65930,
    title: 'My Hero Academia',
    poster: 'https://walter.trakt.tv/images/shows/000/104/311/posters/thumb/af633add9b.jpg',
    poster_wide: 'https://walter.trakt.tv/images/shows/000/104/311/fanarts/full/22c3c6efc2.jpg',
    watched: 89,
    aired: 113,
    season: {
      count: 5,
      poster: 'https://walter.trakt.tv/images/seasons/000/236/954/posters/thumb/76b746ab1e.jpg'
    },
    episode: {
      id: 65930,
      title: 'Vestiges',
      count: 2,
      absolute_count: 90,
      rating: 7.8,
      runtime: 24,
    }
  },
  {
    id: 123446,
    title: 'The Great Jahy Will Not Be Defeated!',
    poster: 'https://walter.trakt.tv/images/seasons/000/255/423/posters/thumb/09aa5ef81e.jpg',
    poster_wide: 'https://walter.trakt.tv/images/shows/000/179/526/fanarts/full/adbedecb31.jpg',
    watched: 8,
    aired: 14,
    season: {
      count: 1,
    },
    episode: {
      id: 123446,
      title: 'Saurva Can\'t Catch a Break...',
      count: 9,
      rating: 7.1,
      runtime: 24,
    }
  },
  {
    id: 118821,
    title: 'The World\'s Finest Assassin Gets Reincarnated in Another World as an Aristocrat',
    poster: 'https://walter.trakt.tv/images/shows/000/175/074/posters/thumb/5515ffd419.jpg',
    poster_wide: 'https://walter.trakt.tv/images/shows/000/175/074/fanarts/full/271fc6689c.jpg',
    watched: 4,
    aired: 5,
    season: {
      count: 1,
    },
    episode: {
      id: 118821,
      title: 'Qualifications of Assassins',
      count: 5,
      rating: 7.1,
      runtime: 24,
    }
  },
  {
    id: 97525,
    title: 'To Your Eternity',
    poster: 'https://walter.trakt.tv/images/shows/000/159/569/posters/thumb/59c0d6f9cd.jpg',
    poster_wide: 'https://walter.trakt.tv/images/shows/000/159/569/fanarts/full/76332e8d7f.jpg',
    watched: 5,
    aired: 20,
    season: {
      count: 1,
    },
    episode: {
      id: 97525,
      title: 'Our Goals',
      count: 6,
      absolute_count: 6,
      rating: 8.0,
      runtime: 24,
    }
  },
  {
    id: 46440,
    title: 'Samurai Girls',
    poster: 'https://walter.trakt.tv/images/seasons/000/062/813/posters/thumb/88ba84a2c9.jpg',
    poster_wide: 'https://walter.trakt.tv/images/shows/000/060/994/fanarts/full/f095f22dc5.jpg',
    watched: 4,
    aired: 24,
    season: {
      count: 1,
    },
    episode: {
      id: 46440,
      title: 'Here Comes the Warrior of Love!',
      count: 5,
      absolute_count: 5,
      rating: 7.4,
      runtime: 25,
    }
  },
]
/**
 * Will be fully documented once there has been a proper API as its subject to change completely once implemented.
 */
setTimeout(() => {
  Array.from(untw.children).forEach((elm, i) => {
    if (i > 0) {
      if (dummyData[i-1]) {
        setTileData(i, dummyData[i-1])
      } else {
        elm.style = 'background-color:var(--watchlist);'
        elm.removeAttribute('loading')
      }
    }
  })
}, 2000)

function setTileData(order, data) {
  let tile = untw.children[order];

  tile.dataset.untwId = data.episode.id;
  tile.dataset.untwTitle = data.title;
  tile.dataset.untwEpisode = parseEpisodeTitle(data);
  tile.style.backgroundImage = `url(${parseEpisodeImage(tile, data)})`;

  tile.innerHTML = `
    &lt;div>
      &lt;div class="fs16 fwSemiBold">
        &lt;div class="actions">
          &lt;div class="btn small">&lt;/div>
          &lt;div class="btn small">&lt;/div>
        &lt;/div>
        &lt;div class="rating">&lt;i class="icon-heart">&lt;/i> ${data.episode.rating}&lt;/div>
      &lt;/div>
      &lt;div class="progress">
        &lt;div style="width:${getProgressRatio(data.watched, data.aired)}%">&lt;/div>
      &lt;/div>
    &lt;/div>
  `;

  tile.onmouseover = () => setTextUNTW(tile);
  tile.onmouseleave = () => setTextUNTW(untw.children[1]);

  setTileActionButton(tile, data, 'play', false);
  setTileActionButton(tile, data, 'watchlist', true);

  if (tile.hasAttribute('data-untw-latest')) {
    setTextUNTW(tile)
  }

  if (tile.hasAttribute('loading')) {
    tile.removeAttribute('loading')
  }
}

/**
 * When user finishes playing an episode / adds to history, the tile list is updated accordingly.
 * @param {HTMLElement} tile 
 */
function updateNextTile(tile) {
  if (tile.hasAttribute('data-untw-latest')) {
    tile.nextElementSibling.setAttribute('data-untw-latest', '');
    setTextUNTW(tile.nextElementSibling)
  }

  tile.remove()

  // creates a new tile to fill in blanks
  if (untw.children.length &lt; 15) {
    untw.appendChild(createTile())
  }
}

/**
 * Used to fill blanks in the tile list.
 * Will be responsible for creating show recommendations, etc.
 * @returns {HTMLElement}
 */
function createTile() {
  let tile = document.createElement('div');
  
  tile.classList.add('shadow');
  tile.style.backgroundColor = 'var(--history)';

  return tile 
}

/**
 * Sets the tile action buttons with the configured settings, its type (play, watchlist, history) and if its the main or secondary button.
 * @param {HTMLElement} tile 
 * @param {string} type
 * @param {boolean} secondary
 */
function setTileActionButton(tile, data, type, secondary) {
  let message;
  let actionContent;

  // when api is available, callback will change according to action type
  let callback = () => {updateNextTile(tile);toggleAlert(false)};

  let actionBtns = tile.children[0].children[0].children[0];
  let btn = secondary ? actionBtns.children[1] : actionBtns.children[0];

  if (type == 'play') {
    message = `Start playing &lt;span>${data.title}: ${parseEpisodeTitle(data)}&lt;/span>?`;
    actionContent = secondary ? '&lt;i class="icon-play">&lt;/i>' : 'play now'
  } else if (type == 'watchlist') {
    message = `Add &lt;span>${data.title}: ${parseEpisodeTitle(data)}&lt;/span> to your watchlist?`;
    actionContent = secondary ? '&lt;i class="icon-watchlist">&lt;/i>' : 'add to watchlist'
  } else if (type == 'history') {
    message = `Add &lt;span>${data.title}: ${parseEpisodeTitle(data)}&lt;/span> to your history?`;
    actionContent = secondary ? '&lt;i class="icon-history">&lt;/i>' : 'add to history'
  }

  btn.innerHTML = actionContent;
  btn.style.backgroundColor = `var(--${type == 'play' ? 'red' : type})`
  btn.onclick = () => {
    setAlertbox('Info', message, {text: 'OK', cb: callback}, {text: 'revert action', cb: () => toggleAlert(false)})
    toggleAlert(true)
  }
}

/**
 * Updates show and episode name in UNTW.
 * @param {HTMLElement} tile 
 */
function setTextUNTW(tile) {
  let data = ['up next to watch', tile.dataset.untwTitle, tile.dataset.untwEpisode];

  Array.from(untw.children[0].children).forEach((elm, i) => {
    elm.innerHTML = data[i];

    if (elm.hasAttribute('loading')) {
      elm.removeAttribute('loading')
    }
  })
}

/**
 * Calculates the ratio between number of episodes watched to total aired episodes in percentage for progress bar.
 * @param {number} number number of episodes watched 
 * @param {number} total number of episodes that have aired
 * @returns {number} float in range 0.0â€“100.0
 */
 function getProgressRatio(number, total) {
  return ((number/total)*100).toFixed(1)
}

/**
 * Parses the data from the API to provided a constructed episode title for UNTW.
 * @returns {string} "0 x 00 (0) Episode Title"
 */
function parseEpisodeTitle(data) {
  let show_count = data.episode.absolute_count;
  return `${data.season.count} &amp;#215; ${data.episode.count} ${show_count ? `(${show_count})`: ''} ${data.episode.title}`
}

/**
 * Optimal image for the tiles with fallback for non-existent ones.
 * @param {HTMLElement} tile 
 * @returns {string} image url
 */
 function parseEpisodeImage(tile, data) {
  if (tile.hasAttribute('data-untw-latest')) {
    return data.season.poster || data.poster
  } else {
    return data.season.poster_wide || data.poster_wide || data.season.poster || data.poster
  }
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated with <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a>.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
